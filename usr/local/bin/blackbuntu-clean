#!/bin/bash
#
# [Package]: blackbuntu-clean
# [Release]: Blackbuntu Revive v1.2 Alpha
# [Website]: https://blackbuntu.org
# [Version]: Revive v1.2 Alpha
# [License]: http://www.gnu.org/licenses/gpl-3.0.html
# 
# Ascii Art : https://www.askapache.com/online-tools/figlet-ascii/

## ----------------- ##
## Define Parameters ##
## ----------------- ##

## Colour output
## -------------
TEXT_ERROR="\033[01;31m"	# Issues/Errors
TEXT_VALID="\033[01;32m"	# Success
TEXT_ALERT="\033[01;33m"	# Warnings/Information
TEXT_TITLE="\033[01;34m"	# Heading
TEXT_RESET="\033[00m"		# Normal

## ---------------- ##
## Define Functions ##
## ---------------- ##

## Display Header
## --------------
function set_banner
{
	clear
	echo -e "${TEXT_ERROR}   _     _            _    _                 _           ${TEXT_RESET}"
	echo -e "${TEXT_ERROR}  | |   | |          | |  | |               | |          ${TEXT_RESET}"
	echo -e "${TEXT_ERROR}  | |__ | | __ _  ___| | _| |__  _   _ _ __ | |_ _   _   ${TEXT_RESET}"
	echo -e "${TEXT_ERROR}  | '_ \| |/ _' |/ __| |/ / '_ \| | | | '_ \| __| | | |  ${TEXT_RESET}"
	echo -e "${TEXT_ERROR}  | |_) | | (_| | (__|   <| |_) | |_| | | | | |_| |_| |  ${TEXT_RESET}"
	echo -e "${TEXT_ERROR}  |_'__/|_|\__'_|\___|_|\_\_'__/ \__'_|_| |_|\__|\__'_|  ${TEXT_RESET}"
	echo -e "${TEXT_ERROR}                                                         ${TEXT_RESET}"
	echo -e "${TEXT_ERROR}                                        Blackbuntu v1.2  ${TEXT_RESET}"         
	echo
	echo -e "${TEXT_VALID} [i] [Package]: blackbuntu-clean${TEXT_RESET}"
	echo -e "${TEXT_VALID} [i] [Website]: https://blackbuntu.org${TEXT_RESET}"

  	echo
  	sleep 3s
}

## Check if provided username exist
## --------------------------------
function check_username
{
	if id "$1" >/dev/null 2>&1; then
	    sleep 1s
	else
		cd /home/$USERNAME/
		echo -e "${TEXT_ERROR}[!]${TEXT_RESET} The username $USERNAME has not been found in the system${TEXT_RESET}"
		echo -e "${TEXT_ERROR}[!]${TEXT_RESET} Quitting ...${TEXT_RESET}"
		echo -e "\n"
		exit 1
	fi
}

## Check Internet status
## ---------------------
function check_internet
{
	for i in {1..10};
	do 
		ping -c 1 -W ${i} www.google.com &>/dev/null && break; 
	done
	
	if [[ "$?" -ne 0 ]]; 
	then
		cd /home/$USERNAME/
		echo -e "${TEXT_ERROR}[!]${TEXT_RESET} An unknown error occured ~ Possible DNS issues${TEXT_RESET}"
		echo -e "${TEXT_ERROR}[!]${TEXT_RESET} Quitting ..."
		exit 1
	fi
}

## Return stage title
## ------------------
function stage_title
{
	echo -e "\n${TEXT_TITLE}[+]${TEXT_RESET} (${1}/${2}) ${TEXT_TITLE}${3^^}${TEXT_RESET}"
	sleep 1s
}

## Return stage output
## -------------------
function stage_output
{
	cd /home/$USERNAME/
	echo -e "${TEXT_VALID}[i] ${1^^}${TEXT_RESET}"
	sleep 1s
}

## ------------ ##
## Start Script ##
## ------------ ##

## Display Header
## --------------
set_banner

## Get Username
## ------------
read -p " Please enter your username : " USERNAME
echo

## Stage counter start
## -------------------
STAGE=0
TOTAL=$(grep '(( STAGE++ ))' $0 | wc -l);(( TOTAL-- ))
clear

## ------------------------------- ##
## Check User Level and Permission ##
## ------------------------------- ##

## Checking Username
## -----------------
check_username $USERNAME

## Switch to Root
## --------------
(( STAGE++ ))
stage_title $STAGE $TOTAL "Switch to Root"
sudo ls -la /tmp/ >/dev/null 2>&1
stage_output "Switched to Root successfully"

## ---------------------------- ##
## Remove Junk and Clean System ##
## ---------------------------- ##

## Delete Firefox Logs
## -------------------
(( STAGE++ ))
stage_title $STAGE $TOTAL "Delete Firefox Logs"
sudo rm -rf /home/$USERNAME/.mozilla/firefox/backup/
sudo rm -rf /home/$USERNAME/.cache/mozilla/firefox/backup/
sudo mkdir -p /home/$USERNAME/.mozilla/firefox/backup/ /home/$USERNAME/.cache/mozilla/firefox/backup/
sudo mv /home/$USERNAME/.mozilla/firefox/*.default/*.sqlite  /home/$USERNAME/.mozilla/firefox/backup/ >/dev/null 2>&1
sudo mv /home/$USERNAME/.mozilla/firefox/*.default/sessionstore.js /home/$USERNAME/.mozilla/firefox/backup/ >/dev/null 2>&1
sudo mv /home/$USERNAME/.cache/mozilla/firefox/*.default/* /home/$USERNAME/.cache/mozilla/firefox/backup/ >/dev/null 2>&1
sudo rm -f /home/$USERNAME/.mozilla/firefox/*.default/cookies.sqlite
sudo rm -f /home/$USERNAME/.mozilla/firefox/*.default/*.sqlite
sudo rm -f /home/$USERNAME/.mozilla/firefox/*default/sessionstore.js
sudo rm -rf /home/$USERNAME/.cache/mozilla/firefox/*.default/*
stage_output "Firefox logs cleaned successfully"

## Delete Chromium Logs
## --------------------
(( STAGE++ ))
stage_title $STAGE $TOTAL "Delete Chromium Logs"
sudo rm -rf /home/$USERNAME/.cache/chromium/* >/dev/null 2>&1
sudo rm -rf /home/$USERNAME/.config/chromium/Default/* >/dev/null 2>&1
stage_output "Chromium logs cleaned successfully"

## Delete Sublime-Text Logs
## ------------------------
(( STAGE++ ))
stage_title $STAGE $TOTAL "Delete Sublime-Text Logs"
sudo rm -rf /home/$USERNAME/.config/sublime-text-3/Local/Session.sublime_session >/dev/null 2>&1
stage_output "Sublime-Text logs cleaned successfully"

## Delete Filezilla Logs
## ---------------------
(( STAGE++ ))
stage_title $STAGE $TOTAL "Delete Filezilla Logs"
sudo rm -rf /home/$USERNAME/.config/filezilla/queue.sqlite3 >/dev/null 2>&1
sudo rm -rf /home/$USERNAME/.config/filezilla/recentservers.xml >/dev/null 2>&1
sudo rm -rf /home/$USERNAME/.config/filezilla/trustedcerts.xml >/dev/null 2>&1
stage_output "Filezilla logs cleaned successfully"

## Delete Machine Logs
## -------------------
(( STAGE++ ))
stage_title $STAGE $TOTAL "Delete Machine Logs"
sudo rm -f /home/$USERNAME/*.backup
sudo rm -f /home/$USERNAME/*.cap
sudo rm -f /home/$USERNAME/*.csv
sudo rm -f /home/$USERNAME/*.log
sudo rm -f /home/$USERNAME/*.netxml
sudo rm -f /home/$USERNAME/*.old
sudo rm -f /home/$USERNAME/*.xml
sudo rm -f /home/$USERNAME/.google-cookie
sudo rm -f /home/$USERNAME/.rsf_history
sudo rm -f /home/$USERNAME/.selected_editor
sudo rm -f /home/$USERNAME/.wget-hsts
sudo rm -f /home/$USERNAME/paused.conf
sudo rm -rf /home/$USERNAME/.arduino15
sudo rm -rf /home/$USERNAME/.binwalk
sudo rm -rf /home/$USERNAME/.BurpSuite
sudo rm -rf /home/$USERNAME/.golismero
sudo rm -rf /home/$USERNAME/.JavaSnoop
sudo rm -rf /home/$USERNAME/.john
sudo rm -rf /home/$USERNAME/.kismet
sudo rm -rf /home/$USERNAME/.magictree
sudo rm -rf /home/$USERNAME/.maltego
sudo rm -rf /home/$USERNAME/.ngrok2
sudo rm -rf /home/$USERNAME/.oracle_jre_usage
sudo rm -rf /home/$USERNAME/.pocsuite
sudo rm -rf /home/$USERNAME/.pocsuiterc
sudo rm -rf /home/$USERNAME/.pyrit
sudo rm -rf /home/$USERNAME/.set
sudo rm -rf /home/$USERNAME/.sqlmap
sudo rm -rf /home/$USERNAME/.wget-hsts
sudo rm -rf /home/$USERNAME/.ZAP
sudo rm -rf /home/$USERNAME/Arduino
sudo rm -rf /home/$USERNAME/global-groovy.log
sudo rm -rf /home/$USERNAME/JavaSnoop.properties
sudo rm -rf /home/$USERNAME/js.log
sudo rm -rf /home/$USERNAME/linset_rev-35.backup
sudo rm -rf /home/$USERNAME/magictree.log
sudo rm -rf /home/$USERNAME/soapui-errors.log
sudo rm -rf /home/$USERNAME/soapui.log
sudo rm -rf /home/$USERNAME/wsattacker_config.xml
sudo rm -rf /home/$USERNAME/yersinia.log
sudo rm -rf /home/$USERNAME/.cache/thumbnails/fail
sudo rm -rf /home/$USERNAME/.cache/thumbnails/large
sudo rm -rf /home/$USERNAME/.cache/thumbnails/normal
sudo rm -f /home/$USERNAME/config/nautilus/servers
sudo find /opt/pentest/exploitation/ -type f -name '*.log' -exec rm -f {} \; >/dev/null 2>&1
sudo find /var/log/ -type f -name '*.gz' -exec rm -f {} \; >/dev/null 2>&1
sudo find /var/log/ -type f -name '*.old' -exec rm -f {} \; >/dev/null 2>&1
sudo find /var/log/ -type f -name '*.1' -exec rm -f {} \; >/dev/null 2>&1
sudo find /var/log/ -type f -name '*.log' -exec rm -f {} \; >/dev/null 2>&1
stage_output "Machine logs cleaned successfully"

## Delete Files History
## --------------------
(( STAGE++ ))
stage_title $STAGE $TOTAL "Delete Files History"
sudo rm -f /home/$USERNAME/.local/share/recently-used.xbel
stage_output "Files history cleaned successfully"

## Delete SSH Keys
## ---------------
(( STAGE++ ))
stage_title $STAGE $TOTAL "Delete SSH Keys"
sudo rm -rf /home/$USERNAME/.ssh/authorized_keys
sudo rm -rf /home/$USERNAME/.ssh/known_hosts
sudo rm -rf /home/$USERNAME/.ssh/known_hosts.old
sudo rm -rf /root/.ssh/authorized_keys
sudo rm -rf /root/.ssh/known_hosts
sudo rm -rf /root/.ssh/known_hosts.old
stage_output "SSH keys deleted successfully"

## Remove Unnecessary Documentations
## ---------------------------------
sudo find /usr/share/doc -depth -type f ! -name copyright -exec rm -rf {} \; >/dev/null 2>&1
sudo find /usr/share/doc -empty -exec rm -rf {} \; >/dev/null 2>&1
sudo rm -rf /usr/share/man >/dev/null 2>&1
sudo rm -rf /usr/share/groff >/dev/null 2>&1
sudo rm -rf /usr/share/info >/dev/null 2>&1
sudo rm -rf /usr/share/lintian >/dev/null 2>&1
sudo rm -rf /usr/share/linda >/dev/null 2>&1
sudo rm -rf /var/cache/man >/dev/null 2>&1
sudo find /usr/share/locale -mindepth 1 -maxdepth 1 ! -name 'en' -exec rm -rf {} \; >/dev/null 2>&1

## Clean Bash History
## ------------------
(( STAGE++ ))
stage_title $STAGE $TOTAL "Clean Bash History"
history -c && history -w
stage_output "Bash history cleaned successfully"

## Delete Persistents Files
## ------------------------
(( STAGE++ ))
stage_title $STAGE $TOTAL "Delete Persistents Files"
sudo rm -rf /home/$USERNAME/.local/share/Trash/*
stage_output "Persistents files deleted successfully"

## Remove APT cache
## ----------------
(( STAGE++ ))
stage_title $STAGE $TOTAL "Remove APT Cache"
sudo rm -rf /var/cache/apt/*
stage_output "APT Cache removed successfully"

## Correct Folders Permissions
## ---------------------------
(( STAGE++ ))
stage_title $STAGE $TOTAL "Correct Folders Permissions"
sudo chown -R $USERNAME:$USERNAME /opt/pentest/
sudo chown -R $USERNAME:$USERNAME /var/www
stage_output "Folder permissions corrected successfully"

## Erase Bash History
## ------------------
true > /home/$USERNAME/.bash_history

## Final Notice
## ------------
echo -e "\n${TEXT_SUCCES}[i]${TEXT_CLEAR} System Cleaned Successfully${TEXT_CLEAR}"
echo -e "${TEXT_NOTICE}[!] Your computer will shutdown within 10 seconds${TEXT_CLEAR}"
sleep 10s
sudo shutdown now
