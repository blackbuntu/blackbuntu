#!/bin/bash
#
# [Package]: BeeF
# [Release]: Blackbuntu Revive v1.0.1 Alpha
# [Website]: https://blackbuntu.org
# [Version]: Revive v1.0.1 Alpha
# [License]: http://www.gnu.org/licenses/gpl-3.0.html
# 
# Ascii Art : https://www.askapache.com/online-tools/figlet-ascii/

## ----------------- ##
## Define Parameters ##
## ----------------- ##

## Colour output
## -------------
TEXT_ERROR="\033[01;31m"	# Issues/Errors
TEXT_VALID="\033[01;32m"	# Success
TEXT_ALERT="\033[01;33m"	# Warnings/Information
TEXT_TITLE="\033[01;34m"	# Heading
TEXT_RESET="\033[00m"		# Normal

## ---------------- ##
## Define Functions ##
## ---------------- ##

## Display Header
## --------------
function set_banner
{
	clear
	echo -e "${TEXT_ERROR}   _     _            _    _                 _           ${TEXT_RESET}"
	echo -e "${TEXT_ERROR}  | |   | |          | |  | |               | |          ${TEXT_RESET}"
	echo -e "${TEXT_ERROR}  | |__ | | __ _  ___| | _| |__  _   _ _ __ | |_ _   _   ${TEXT_RESET}"
	echo -e "${TEXT_ERROR}  | '_ \| |/ _' |/ __| |/ / '_ \| | | | '_ \| __| | | |  ${TEXT_RESET}"
	echo -e "${TEXT_ERROR}  | |_) | | (_| | (__|   <| |_) | |_| | | | | |_| |_| |  ${TEXT_RESET}"
	echo -e "${TEXT_ERROR}  |_'__/|_|\__'_|\___|_|\_\_'__/ \__'_|_| |_|\__|\__'_|  ${TEXT_RESET}"
	echo -e "${TEXT_ERROR}                                                         ${TEXT_RESET}"
	echo -e "${TEXT_ERROR}                                      Blackbuntu v1.0.1  ${TEXT_RESET}"         
	echo
	echo -e "${TEXT_VALID} [i] [Package]: beef${TEXT_RESET}"
	echo -e "${TEXT_VALID} [i] [Website]: https://blackbuntu.org${TEXT_RESET}"

  	echo
  	sleep 3s
}

## Check if provided username exist
## --------------------------------
function check_username
{
	if id "$1" >/dev/null 2>&1; then
	    sleep 1s
	else
		cd /tmp/
		echo
		echo -e " ${TEXT_ERROR}[!]${TEXT_RESET} The username $USERNAME has not been found in the system"
		echo -e " ${TEXT_ERROR}[!]${TEXT_RESET} Quitting ..."
		echo -e "\n"
		exit 1
	fi
}

## Check Internet status
## ---------------------
function check_internet
{
	for i in {1..10};
	do 
		ping -c 1 -W ${i} www.google.com &>/dev/null && break; 
	done
	
	if [[ "$?" -ne 0 ]]; 
	then
		cd /tmp/
		echo
		echo -e " ${TEXT_ERROR}[!]${TEXT_RESET} An unknown error occured ~ Possible DNS issues or no Internet connection"
		echo -e " ${TEXT_ERROR}[!]${TEXT_RESET} Quitting ..."
		echo -e "\n"
		exit 1
	fi
}

## ------------ ##
## Start Script ##
## ------------ ##

## Prompt for SUDO Password
## ------------------------
clear
sudo -v

## Display Header
## --------------
set_banner

## Prompt User for Confirmation
## ----------------------------
echo -e " BeeF is not yet installed."
read -p " Do you want to install it now [Y/n] ? " -n 1 -r
echo
if [[ $REPLY =~ ^[Yy]$ ]]
then
	echo
	read -p " Please enter your username : " USERNAME
	check_username $USERNAME
	check_internet

	echo -e " Please wait while installing BeeF ..."
	sleep 5s

	sudo rm -f /usr/bin/beef
	cd /opt/blackbuntu/exploitation/beef/
	sudo ./install
	sudo touch /usr/local/bin/beef
	sudo chmod +x /usr/local/bin/beef
	echo '#!/bin/bash' | sudo tee -a /usr/local/bin/beef >/dev/null 2>&1
	echo 'clear' | sudo tee -a /usr/local/bin/beef >/dev/null 2>&1
	echo 'cd /opt/blackbuntu/exploitation/beef/' | sudo tee -a /usr/local/bin/beef >/dev/null 2>&1
	echo 'sudo ./beef $@' | sudo tee -a /usr/local/bin/beef >/dev/null 2>&1
	cd /tmp/

	echo
	echo -e " ${TEXT_VALID}[i]${TEXT_RESET} BeeF has been installed successfully"
	echo -e " ${TEXT_VALID}[i]${TEXT_RESET} Close this terminal and re-open BeeF"
	echo -e "\n"
else
	echo
	echo -e " ${TEXT_ERROR}[!]${TEXT_RESET} Operation aborted by user"
	echo -e " ${TEXT_ERROR}[!]${TEXT_RESET} Quitting ..."
	echo -e "\n"
	exit 1
fi
